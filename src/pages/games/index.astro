---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getAllGames } from '../../lib/games';

const games = getAllGames();
const industries = [...new Set(games.map(g => g.industry))];
---

<BaseLayout title="All Games" description="14 game concepts spanning every entertainment industry.">
  <!-- Header -->
  <section class="pt-28 pb-16 px-6 md:px-10">
    <p class="font-[family-name:var(--font-label)] text-[10px] tracking-[0.35em] uppercase text-[var(--color-smoke)] mb-6">
      Index
    </p>
    <h1 class="font-[family-name:var(--font-headline)] text-5xl md:text-7xl font-900 italic leading-[0.9] text-[var(--color-cream)]">
      All Games
    </h1>
  </section>

  <!-- Filter -->
  <section class="px-6 md:px-10 pb-10 flex flex-wrap gap-3">
    <button
      class="filter-btn active font-[family-name:var(--font-label)] text-[10px] tracking-[0.2em] uppercase pb-1 border-b border-[var(--color-chalk)] text-[var(--color-chalk)] transition-colors cursor-pointer"
      data-filter="all"
    >All</button>
    {industries.map(ind => (
      <button
        class="filter-btn font-[family-name:var(--font-label)] text-[10px] tracking-[0.2em] uppercase pb-1 border-b border-transparent text-[var(--color-smoke)] hover:text-[var(--color-fog)] transition-colors cursor-pointer"
        data-filter={ind}
      >{ind}</button>
    ))}
  </section>

  <!-- Game Table -->
  <section class="px-6 md:px-10 pb-24">
    <div class="border-t border-[var(--color-ash)]/40">
      {games.map((game, i) => (
        <a
          href={`/games/${game.slug}`}
          class="game-row group flex flex-col md:flex-row md:items-center gap-2 md:gap-6 py-6 border-b border-[var(--color-ash)]/20 hover:border-[var(--color-ash)]/50 transition-colors"
          data-industry={game.industry}
        >
          <!-- Number -->
          <span class="font-[family-name:var(--font-label)] text-[10px] tracking-[0.3em] uppercase w-12 flex-shrink-0" style={`color: ${game.accent};`}>
            {game.number}
          </span>

          <!-- Title -->
          <span
            class="font-[family-name:var(--font-headline)] text-2xl md:text-3xl font-700 text-[var(--color-chalk)] group-hover:text-[var(--color-cream)] transition-colors flex-1 leading-tight"
            transition:name={`game-title-${game.slug}`}
          >
            {game.title}
          </span>

          <!-- Comparable -->
          <span class="font-[family-name:var(--font-ui)] text-sm text-[var(--color-smoke)] group-hover:text-[var(--color-fog)] transition-colors md:w-72 flex-shrink-0">
            {game.comparable}
          </span>

          <!-- Industry -->
          <span class="font-[family-name:var(--font-label)] text-[9px] tracking-[0.25em] uppercase text-[var(--color-ash)] group-hover:text-[var(--color-smoke)] transition-colors md:w-32 flex-shrink-0 text-right hidden md:block">
            {game.industry}
          </span>

          <!-- Arrow -->
          <span class="text-[var(--color-ash)] group-hover:text-[var(--color-chalk)] transition-colors hidden md:block" style={`color: ${game.accent}; opacity: 0; transition: opacity 0.3s;`}>
            &rarr;
          </span>
        </a>
      ))}
    </div>
  </section>

  <script>
    // Arrow show on hover
    document.querySelectorAll('.game-row').forEach(row => {
      const arrow = row.querySelector('span:last-child') as HTMLElement;
      if (!arrow) return;
      row.addEventListener('mouseenter', () => { arrow.style.opacity = '1'; });
      row.addEventListener('mouseleave', () => { arrow.style.opacity = '0'; });
    });

    // Filtering
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const filter = (btn as HTMLElement).dataset.filter;

        document.querySelectorAll('.filter-btn').forEach(b => {
          (b as HTMLElement).classList.remove('active');
          (b as HTMLElement).style.borderColor = 'transparent';
          (b as HTMLElement).style.color = '';
          b.classList.add('text-[var(--color-smoke)]');
        });

        (btn as HTMLElement).classList.add('active');
        (btn as HTMLElement).style.borderColor = '#e8e4df';
        (btn as HTMLElement).style.color = '#e8e4df';

        document.querySelectorAll('.game-row').forEach(row => {
          const ind = (row as HTMLElement).dataset.industry;
          (row as HTMLElement).style.display = (filter === 'all' || ind === filter) ? '' : 'none';
        });
      });
    });
  </script>
</BaseLayout>
